<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MongoDB Replicaset Dashboard</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    table { border-collapse: collapse; width: 100%; }
    th, td { padding: 8px 12px; border: 1px solid #ccc; text-align: left; }
    .ok { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h1>MongoDB Replicaset Dashboard</h1>
  <nav>
    <a href="/">Home</a> |
    <a href="/query">Query</a> |
    <a href="/config">Config</a>
  </nav>
  <h2>Node Status</h2>
  <table id="nodes">
    <thead>
      <tr><th>Host</th><th>State</th><th>Lag (ms)</th></tr>
    </thead>
    <tbody></tbody>
  </table>
  <script>
    const tableBody = document.querySelector('#nodes tbody');
    const socket = io();
    socket.on('replica', (data) => {
      tableBody.innerHTML = '';
      if (!data.ok) {
        tableBody.innerHTML = `<tr><td colspan="3" class="error">${data.error}</td></tr>`;
        return;
      }
      data.members.forEach(m => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${m.name}</td><td>${m.stateStr}</td><td>${m.lag}</td>`;
        tableBody.appendChild(tr);
      });
    });
  </script>
</body>
</html>